

d3.csv("evolution2.csv",function(error,d){
	alldata=d;
	data=alldata.filter(function(e){return e.to < years[1];});	
	//data=alldata;
	
    x.domain([d3.max(data, function(element) { return parseFloat(element.to); }),0]);
    //y.domain(data.map(function(element) {return element.class}));
	y.domain([0,d3.max(data, function(element) { return parseFloat(element.order); })]);
	

    var bars = svg.selectAll(".bar")
        .data(data)
        .enter()
	  .append("rect")
	    .attr("class",function(d) {return "bar selected " + d.attr + " " + d.book})
	    .attr("id",function(d,i) {return "sel-" + i})
        .attr("x", function(d) {return x(parseFloat(d.to)) + padding.left})
        .attr("y", function(d) {return ((h_main- padding.top - padding.bottom)/rows+5) * d.order +adjust;})//adjust为数据调整的高度
        .attr("width", function(d) {return x(d3.max(data, function(element) { return parseFloat(element.to); })- parseFloat(d.time))})
        .attr("height", 10)
		.classed("selected",false)
		.on("mouseover",function(d,i){ d3.selectAll("#sel-"+i).classed("selected", true);})
		.on("mouseout",function(d){ d3.selectAll(".selected").classed("selected", false);}); 
		
	var text = svg.selectAll("text")
		.data(data).enter()
	  .append("text")
		//.attr("class", "text selected")
	    .attr("class",function(d) {return "text selected " + d.attr + " " + d.book})
	    .attr("id",function(d,i) {return "sel-" + i})
		.text(function(d){return d.class;})
		.attr("x", function(d) {return x(parseFloat(d.from)) + padding.left+5})	
		.attr("y", function(d) {return ((h_main- padding.top - padding.bottom)/rows+5) * d.order +adjust +10;})
		.classed("selected",false)
		.on("mouseover",function(d,i){ d3.selectAll("#sel-"+i).classed("selected", true);})
		.on("mouseout",function(d){ d3.selectAll(".selected").classed("selected", false);}); 
	
			
	var text2 = svg.selectAll(".text2")
		.data(data).enter()
	  .append("text")
		//.attr("class", "text selected")
	    .attr("class",function(d) {return "text2 selected " + d.attr + " " + d.book})
	    .attr("id",function(d,i) {return "sel-" + i})
		.text(function(d){return "约" + d.to + "-" + d.from + "百万年";})
		.attr("x", function(d) {return x(parseFloat(d.from)) + padding.left+10 + (d.class).length*12 })	
		.attr("y", function(d) {return ((h_main- padding.top - padding.bottom)/rows+5) * d.order +adjust+10;})
		.classed("selected",false); 
		
	//图例	
	svg.append("rect")
        .attr("x", padding.left)
        .attr("y", padding.top-100)
        .attr("width", 10)
        .attr("height", function(d) {return (h_main- padding.top - padding.bottom)/d3.max(data, function(element) { return parseFloat(element.order); })-5})
		.style("fill","steelblue");
	svg.append("text")
	    .attr("class","text")
        .attr("x", padding.left+15)
        .attr("y", padding.top-92)
        .text("《人类通史》");
		
	svg.append("rect")
        .attr("x", padding.left)
        .attr("y", padding.top-85)
        .attr("width", 10)
        .attr("height", function(d) {return (h_main- padding.top - padding.bottom)/d3.max(data, function(element) { return parseFloat(element.order); })-5})
		.style("fill","orange");		
	svg.append("text")
	    .attr("class","text")
        .attr("x", padding.left+15)
        .attr("y", padding.top-77)
        .text("《演化》");
	
    //选择尺度	
	svg.append("text")
		.text("点击选择尺度：")
        .attr("class", "title")
		.attr("transform","translate(" + (padding.left-5) + "," +  (padding.top-50) + ")")		
	svg.selectAll(".yScale")
		.data(yearScale).enter()
		.append("text")
	    .attr("class","yearScale")
        .attr("x", function(d,i){return padding.left + i*80 + 100})
        .attr("y", padding.top-50)
        .text(function(d){return d})
	    .on("click",function(d,i){location.href=hef[i];});

	
	//标题
	svg.append("text")
		.text("人类演化进程（百万年）")
        .attr("class", "title")
		.attr("transform","translate(" + (padding.left-5) + "," +  (padding.top-15) + ")")
		
    svg.append("g")
        .call(xAxis)
        .attr("class", "x axis")
		.attr("transform","translate(" + (padding.left) + "," +  (padding.top +10) + ")")
			   
    svg.append("g")
        .call(yAxis)
        .attr("class","y axis")
		.attr("transform","translate(" + (padding.left) + "," +  (padding.top +10) + ")")
		
		});
//the d3.csv end  



	</script>
</body>
</html>

